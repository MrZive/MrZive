<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zive.dataOut.common">

	<select id="getShop" parameterType="com.zive.dataOut.entity.Shop" resultType="com.zive.dataOut.entity.Shop">
		SELECT
		id,
        no,
        name,
        parent_id parentId,
        status,
        create_date_time createDateTime,
        create_user_id createUserId,
        is_shop isShop,
        region,
        chief_id chiefId,
        address,
        is_schedule_alert isScheduleAlert,
        region_id regionId
		FROM 
		oa_department_structure
		<where>
			<if test="id != null">
				and id = #{id}
			</if>
			<if test="name != null">
				and name = #{name}
			</if>
			<if test="no != null">
				and no = #{no}
			</if>
			<if test="nameLike != null">
				and name LIKE CONCAT(CONCAT('%', #{nameLike}), '%')
			</if>
			<if test="nameNotLike != null">
				and name NOT LIKE CONCAT(CONCAT('%', #{nameNotLike}), '%')
			</if>
			<if test="status != null">
				and status = #{status}
			</if>
			<if test="isShop != null">
				and is_shop = #{isShop}
			</if>
		</where>
	</select>

	<select id="getMemberCard" parameterType="com.zive.dataOut.entity.MemberCard" resultType="com.zive.dataOut.entity.MemberCard">
		select
		id,
		phone 'phone',
		name,
		is_introduce 'isIndroduce',
		introducer,
		activate_date 'activateDate',
		birthday,
		gender 'gender',
		no_phone 'noPhone',
		addr 'address',
		shop_id 'shopId',
		is_pass 'isPass',
		is_abandon 'isAbandon',
		pass_shop_id 'passShopId',
		new_pass_shop_id 'newPassShopId',
		is_active 'isActive',
		is_introduce 'isIntroduce',
		is_sleep 'isSleep',
		pass_time 'passTime',
		standard_time 'standardTime',
		status 'status',
		store_balance 'storeBalance',
		point_balance 'pointBalance',
		treatment_balance 'treatmentBalance',
		stock_balance 'stockBalance',
		owe_balance 'oweBalance',
		is_new_pass 'isNewPass',
		new_pass_time 'newPassTime',
		new_pass_shop_id 'newPassShopId',
		new_pass_consumption_id 'newPassConsumptionId',
		create_date 'createDate'
		from shop_s_member_card
		<where>
			<if test="id != null">
				and id = #{id}
			</if>
			<if test="phone != null">
				and phone = #{phone}
			</if>
			<if test="status != null">
				and status = #{status}
			</if>
			<if test="isPass != null">
				and is_pass = #{isPass}
			</if>
		</where>
	</select>
	
	
	<select id="getMaterial" parameterType="com.zive.dataOut.entity.MaterialInfo" resultType="com.zive.dataOut.entity.MaterialInfo">
		SELECT
		    id,
		    no,
		    name,
		    small_unit smallUnit,
		    big_unit bigUnit,
		    number,
		    status,
		    type,
		    remark,
		    create_date_time createDateTime,
		    isapply isApply,
		    ischeck isCheck,
		    price,
		    boxes_price boxesPrice,
		    form,
		    tax,
		    tax_price taxPrice,
		    deliver_unit deliverUnit,
		    picture_path picturePath,
		    packet,
		    yongyou_id yongyouId
		FROM
		    shop_b_material_info
		<where>
			<if test ='null != no'>AND no = #{no}</if>
            <if test ='null != name'>AND name = #{name}</if>
            <if test ='null != status'>AND status = #{status}</if>
            <if test ='null != type'>AND type = #{type}</if>
            <if test ='null != isApply'>AND isapply = #{isApply}</if>
            <if test ='null != isCheck'>AND ischeck = #{isCheck}</if>
            <if test ='null != yongyouId'>AND yongyou_id = #{yongyouId}</if>
		</where>
	</select>
	
	<select id="getMaterialInventory" parameterType="com.zive.dataOut.entity.MaterialInventory" resultType="com.zive.dataOut.entity.MaterialInventory">
		SELECT
		    inventory_id inventoryId,      
		    material_id materialId,
		    material_price materialPrice,
		    shop_id shopId,
		    usable_inventory usableInventory,
		    check_inventory checkInventory,
		    alert_inventory alertInventory,
		    create_time createTime
		FROM
		    shop_b_material_inventory
		<where>
			<if test ='null != inventoryId'>AND inventory_id = #{inventoryId}</if>
	        <if test ='null != materialId'>AND material_id = #{materialId}</if>
	        <if test ='null != shopId'>AND shop_id = #{shopId}</if>
		</where>
	</select>
	

	<select id="getProductInfo" resultType="com.zive.dataOut.entity.ProductInfo" parameterType="com.zive.dataOut.entity.ProductInfo">
		SELECT
		id,
        no,
        name,
        bulk_unit bulkUnit,
        boxes_unit boxesUnit,
        market_price marketPrice,
        boxes_market_price boxesMarketPrice,
        type,
        status,
        create_date_time createDateTime,
        num,
        promotion_price promotionPrice,
        boxes_promotion_price boxesPromotionPrice,
        experience_price experiencePrice,
        boxes_experience_price boxesExperiencePrice,
        effective_months effectiveMonths,
        standard,
        update_status updateStatus,
        show_status showStatus,
        is_express isExpress,
        is_sale isSale
		FROM
		shop_b_product_info
		<where>
			<if test="id != null">
				a.id = #{id}
			</if>
			<if test="no != null">
				a.no = #{no}
			</if>
			<if test="status != null">
				a.status = #{status}
			</if>
		</where>
	</select>
	
	
	<select id="getProjectInfo" resultType="com.zive.dataOut.entity.ProjectInfo" parameterType="com.zive.dataOut.entity.ProjectInfo">
		SELECT
		id,
        no,
        name,
        type,
        status,
        create_date_time createDateTime,
        effective_months effectiveMonths,
        update_status updateStatus,
        show_status showStatus,
        is_sale isSale,
        is_calculate_sal isCalculateSal,
        is_come isCome,
        is_consume isConsume
		FROM
		shop_b_project_info
		<where>
			<if test="id != null">
				AND id = #{id}
			</if>
			<if test="no != null">
				AND no = #{no}
			</if>
			<if test="status != null">
				AND status = #{status}
			</if>
		</where>
	</select>
	
	
	<select id="getCooperationProject" resultType="com.zive.dataOut.entity.CooperationProject" parameterType="com.zive.dataOut.entity.CooperationProject">
		SELECT
  		id,
        no,
        name,
        unit,
        price,
        percent,
        effective_cycle effectiveCycle,
        no_limit_price noLimitPrice,
        create_user_id createUserId,
        create_date_time createDateTime,
        status,
        is_wenxiu isWenxiu,
        first_earn firstEarn,
        is_count_comsume isCountComsume,
        is_calculate_sal isCalculateSal,
        is_come isCome,
        is_consume isConsume
		FROM
		shop_b_cooperation_project
		<where>
			<if test="id != null">
				AND id = #{id}
			</if>
			<if test="no != null">
				AND no = #{no}
			</if>
			<if test="status != null">
				AND status = #{status}
			</if>
		</where>
	</select>
	
	<select id="getConsumption" resultType="com.zive.dataOut.entity.Consumption" parameterType="com.zive.dataOut.entity.Consumption">
		SELECT
		id,
        member_card_id memberCardId,
        shop_id shopId,
        consumption_date consumptionDate,
        create_user_id createUserId,
        create_date createDate,
        status,
        is_link_fail isLinkFail,
        fail_id failId,
        fail_date failDate,
        is_over_fail isOverFail,
        is_cooperation isCooperation,
        region,
        maker_id makerId,
        ostype,
        fail_user_id failUserId,
        is_tuoke isTuoke,
        fail_earn failEarn,
        is_detail_pay isDetailPay,
        receipt_shop_type receiptShopType
        FROM
        shop_s_consumption
       	<where>
       		<if test="id != null">
       			AND id = #{id}
       		</if>
       		<if test="memberCardId != null">
       			AND member_card_id = #{memberCardId}
       		</if>
       		<if test="shopId != null">
       			AND shop_id = #{shopId}
       		</if>
       	</where>
	</select>
	
	
	<select id="getCanDoneMemberProjectNumber" resultType="map" parameterType="string">
		SELECT 
		c.id,
		c.name,
		a.buy_number 'buyNumber',
		a.number 'leftNumber',
		a.is_book 'isBook',
		a.owe,
		a.price,
		a.real_payment 'realPayment'
		FROM shop_s_consumption_project_detail a
		INNER JOIN shop_s_consumption b ON a.consumption_id = b.id AND b.is_cooperation = 0
		INNER JOIN shop_b_project_info c ON a.project_id = c.id
		LEFT JOIN shop_s_consumption_project  g ON g.consumption_id = a.consumption_id
		WHERE
		b.`status` = 1
		and (a.number > 0 or a.is_count = 0)
		and a.is_fail = 0
		and b.member_card_id = #{memberCardId}
	</select>

</mapper>